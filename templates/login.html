<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>åŸå¸‚è½¨é“äº¤é€šæœåŠ¡è´¨é‡è¯„ä»·ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='css/style.css') }}">
    <script type="text/javascript" src="{{ url_for('static',filename='js/jquery.min.js') }}"></script>
</head>
<body>
<!-- é¡µé¢é¡¶éƒ¨çš„è£…é¥°æ¡ -->
<div class="top-bar"></div>

<!-- ä¸»å†…å®¹åŒºåŸŸ -->
<div class="login-container">
    <!-- ç³»ç»Ÿæ ‡å¿—å’Œæ ‡é¢˜ -->
    <div class="system-title">
        <div class="logo-container">
            <div class="metro-logo">
                <div class="metro-line-h"></div>
                <div class="metro-line-v"></div>
                <div class="metro-dot"></div>
            </div>
        </div>
        <h1>é«˜è€ƒå¿—æ„¿æ¨èç³»ç»Ÿ</h1>
        <p>é«˜è€ƒå¿—æ„¿æ¨èå¹³å°</p>
    </div>
    
    <!-- ç™»å½•çª—ä½“ -->
    <div class="auth-form" id="denglu">
        <div class="auth-form-header">
            <h3>ç³»ç»Ÿç™»å½•</h3>
        </div>
        <form action="" method="post">
            <div class="auth-form-content">
                <div class="form-item">
                    <label for="username">
                        <i class="icon-user"></i>
                    </label>
                    <input type="text" id="username" placeholder="è¯·è¾“å…¥è´¦å·">
                </div>
                <div class="form-item">
                    <label for="password">
                        <i class="icon-lock"></i>
                    </label>
                    <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <div class="form-item">
                    <label for="role">
                        <i class="icon-role"></i>
                    </label>
                    <div class="select-wrapper">
                        <select id="role">
                            <option value="admin">ç®¡ç†å‘˜</option>
                            <option value="user">æ™®é€šç”¨æˆ·</option>
                        </select>
                    </div>
                </div>
                <div class="form-item">
                    <button type="button" id="login">ç™»å½•ç³»ç»Ÿ</button>
                </div>
                <div class="form-divider">
                    <span>æˆ–</span>
                </div>
                <div class="form-item">
                    <a href="javascript:void(0);" id="create">æ³¨å†Œæ–°è´¦å·</a>
                </div>
            </div>
        </form>
    </div>
    
    <!-- æ³¨å†Œçª—ä½“ -->
    <div class="auth-form" id="zhuce" style="display: none;">
        <div class="auth-form-header">
            <h3>æ³¨å†Œæ–°è´¦å·</h3>
        </div>
        <form action="" method="post">
            <div class="auth-form-content">
                <div class="form-item">
                    <label for="reg_username">
                        <i class="icon-user"></i>
                    </label>
                    <input type="text" id="reg_username" placeholder="æ‚¨çš„ç”¨æˆ·å">
                </div>
                <div class="form-item">
                    <label for="reg_password">
                        <i class="icon-lock"></i>
                    </label>
                    <input type="password" id="reg_password" placeholder="è¾“å…¥å¯†ç ">
                </div>
                <div class="form-item">
                    <label for="reg_confirm_password">
                        <i class="icon-lock"></i>
                    </label>
                    <input type="password" id="reg_confirm_password" placeholder="å†æ¬¡ç¡®è®¤å¯†ç ">
                </div>
                <div class="form-item">
                    <label for="reg_phone">
                        <i class="icon-phone"></i>
                    </label>
                    <input type="text" id="reg_phone" placeholder="è¾“å…¥æ‰‹æœºå·ç ">
                </div>
                <div class="form-item">
                    <label for="reg_email">
                        <i class="icon-email"></i>
                    </label>
                    <input type="email" id="reg_email" placeholder="è¾“å…¥é‚®ç®±åœ°å€">
                </div>
                <div class="form-item">
                    <label for="reg_role">
                        <i class="icon-role"></i>
                    </label>
                    <div class="select-wrapper">
                        <select id="reg_role">
                            <option value="user">æ™®é€šç”¨æˆ·</option>
                            <option value="admin">ç®¡ç†å‘˜</option>
                        </select>
                    </div>
                </div>
                <div class="form-item btn-group">
                    <button type="button" id="register">æ³¨å†Œ</button>
                    <button type="button" id="back_to_login" class="btn-secondary">è¿”å›ç™»å½•</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- åœ¨ body ä¸­æ·»åŠ é®ç½©å±‚ div -->
<div class="overlay" id="overlay"></div>

<!-- åº•éƒ¨ç‰ˆæƒä¿¡æ¯ -->
<div class="footer">
    <p>Â© é«˜è€ƒå¿—æ„¿æ¨èç³»ç»Ÿ</p>
    <div class="gov-info">
        <span>ä¸»ç®¡å•ä½ï¼šæ•™è‚²éƒ¨</span>
        <span>è¿è¥æ”¯æŒï¼šä¸­å›½é«˜è€ƒ</span>
    </div>
</div>

<script>
$(function(){
    // å…¬å…±å¼¹çª—æç¤ºå‡½æ•°
    function showMessage(message, type = 'success', duration = 3000) {
        // ç§»é™¤å¯èƒ½å·²å­˜åœ¨çš„æ¶ˆæ¯æ¡†
        $('.message-box').remove();
        
        // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼
        let bgColor, icon;
        switch(type) {
            case 'success':
                bgColor = '#26a269';
                icon = 'âœ“';
                break;
            case 'error':
                bgColor = '#c01c28';
                icon = 'âœ—';
                break;
            case 'warning':
                bgColor = '#cd9309';
                icon = 'âš ';
                break;
            case 'info':
                bgColor = '#1a5fb4';
                icon = 'â„¹';
                break;
            default:
                bgColor = '#26a269';
                icon = 'âœ“';
        }
        
        // åˆ›å»ºæ¶ˆæ¯æ¡†å…ƒç´ 
        const messageBox = $(`
            <div class="message-box" style="background-color: ${bgColor}">
                <span class="message-icon">${icon}</span>
                <span class="message-text">${message}</span>
            </div>
        `);
        
        // æ·»åŠ åˆ°é¡µé¢
        $('body').append(messageBox);
        
        // æ˜¾ç¤ºæ¶ˆæ¯æ¡†
        setTimeout(() => {
            messageBox.addClass('show');
        }, 10);
        
        // è®¾ç½®å®šæ—¶å…³é—­
        setTimeout(() => {
            messageBox.removeClass('show');
            setTimeout(() => {
                messageBox.remove();
            }, 300);
        }, duration);
    }
    
    // ç™»å½•åŠŸèƒ½
    $("#login").click(function(){
        var username=$("#username").val();
        var password=$("#password").val();
        var role = $('#role').val();
        
        // æ·»åŠ è¡¨å•éªŒè¯
        if(!username || !password) {
            showMessage('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'warning');
            return;
        }
        
        var dataJ=JSON.stringify({'username':username,'password':password,'role':role});
        console.log(dataJ);
        $.ajax({
            url: '/user/loginApi',
            method: 'Post',
            dataType: 'json',
            data:dataJ,
            contentType: 'application/json',
            success: function (response) {
                console.log(response);
                if(response.code==200){
                    if(response.data.role==="ç®¡ç†å‘˜"){
                    window.location.href = '/adminHome';
                }else{
                    window.location.href = '/';
                }
                }else{
                    showMessage(response.msg, 'error');
                }
            },
            error: function (xhr, status, error) {
                console.log('Error: ' + error);
                showMessage('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
            }
        });
    });

    // ç®€åŒ–æ˜¾ç¤ºæ³¨å†Œè¡¨å•
    $("#create").click(function(){
        $("#denglu").hide();
        $("#zhuce").show();
    });
    
    // ç®€åŒ–è¿”å›ç™»å½•è¡¨å•
    $("#back_to_login").click(function(){
        $("#zhuce").hide();
        $("#denglu").show();
    });
    
    // æ³¨å†ŒåŠŸèƒ½
    $("#register").click(function(){
        var username = $("#reg_username").val();
        var password = $("#reg_password").val();
        var confirm_password = $("#reg_confirm_password").val();
        var phone = $("#reg_phone").val();
        var email = $("#reg_email").val();
        var role = $("#reg_role").val();
        
        // è¡¨å•éªŒè¯
        if(!username || !password || !confirm_password || !phone || !email) {
            showMessage("è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼", "warning");
            return;
        }
        
        if(password !== confirm_password) {
            showMessage("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼", "warning");
            return;
        }
        
        // éªŒè¯æ‰‹æœºå·æ ¼å¼
        if(!/^1[3-9]\d{9}$/.test(phone)) {
            showMessage("è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ï¼", "warning");
            return;
        }
        
        // éªŒè¯é‚®ç®±æ ¼å¼
        if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            showMessage("è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€ï¼", "warning");
            return;
        }
        
        var data = {
            'username': username,
            'password': password,
            'phone': phone,
            'email': email,
            'role': role
        };
        
        $.ajax({
            url: '/user/registerApi',
            method: 'POST',
            dataType: 'json',
            data: JSON.stringify(data),
            contentType: 'application/json',
            success: function(response) {
                if(response.code === 200) {
                    // ä½¿ç”¨è‡ªå®šä¹‰å¼¹çª—æ›¿ä»£alert
                    showMessage("æ³¨å†ŒæˆåŠŸï¼å³å°†è¿”å›ç™»å½•ç•Œé¢", "success");
                    
                    // å»¶è¿Ÿè¿”å›ç™»å½•ç•Œé¢
                    setTimeout(function() {
                        $("#zhuce").hide();
                        $("#denglu").show();
                        // æ¸…ç©ºæ³¨å†Œè¡¨å•
                        $("#reg_username").val('');
                        $("#reg_password").val('');
                        $("#reg_confirm_password").val('');
                        $("#reg_phone").val('');
                        $("#reg_email").val('');
                    }, 2000);
                } else {
                    showMessage(response.msg || "æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•", "error");
                }
            },
            error: function(xhr, status, error) {
                console.log('Error: ' + error);
                showMessage("æ³¨å†Œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥", "error");
            }
        });
    });
});

// è¾…åŠ©å‡½æ•°
function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function validatePhone(phone) {
    return /^1[3-9]\d{9}$/.test(phone);
}
</script>

<style>
/* æ•´ä½“é¡µé¢æ ·å¼ - æ”¿åŠ¡é£æ ¼ */
body {
    margin: 0;
    padding: 0;
    font-family: 'å¾®è½¯é›…é»‘', 'Microsoft YaHei', Arial, sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
    background-color: #f8fafc;
}

/* é¡¶éƒ¨è£…é¥°æ¡ */
.top-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    z-index: 10;
    background: linear-gradient(to right, 
        #cc0000 0%, #cc0000 20%, 
        #1a5fb4 20%, #1a5fb4 40%, 
        #cc0000 40%, #cc0000 60%, 
        #1a5fb4 60%, #1a5fb4 80%, 
        #cc0000 80%, #cc0000 100%);
}

/* ä¸»ä½“å¸ƒå±€ */
.login-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    width: 100%;
    padding: 20px;
    box-sizing: border-box;
}

/* ç³»ç»Ÿæ ‡é¢˜éƒ¨åˆ† */
.system-title {
    text-align: center;
    margin-bottom: 25px;
}

/* Logoè®¾è®¡ */
.logo-container {
    display: flex;
    justify-content: center;
    margin-bottom: 15px;
}

.metro-logo {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: white;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    border: 1px solid #dce6f1;
    padding: 5px;
}

.metro-line-h {
    position: absolute;
    width: 40px;
    height: 3px;
    background-color: #1a5fb4;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.metro-line-v {
    position: absolute;
    width: 3px;
    height: 40px;
    background-color: #1a5fb4;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.metro-dot {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: #cc0000;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* æ ‡é¢˜æ–‡å­— */
.system-title h1 {
    font-size: 24px;
    font-weight: 600;
    color: #0c326f;
    margin: 0 0 8px 0;
}

.system-title p {
    font-size: 14px;
    color: #5b7a9d;
    margin: 0;
}

/* è¡¨å•å¡ç‰‡ */
.auth-form {
    background: #ffffff;
    border-radius: 6px;
    width: 360px;
    max-width: 100%;
    margin: 0 auto;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border: 1px solid #edf2f7;
    overflow: hidden;
}

.auth-form-header {
    background-color: #f8fafc;
    border-bottom: 1px solid #edf2f7;
    padding: 15px 0;
}

.auth-form-header h3 {
    margin: 0;
    text-align: center;
    color: #1a5fb4;
    font-size: 18px;
    font-weight: 500;
}

.auth-form-content {
    padding: 20px 25px;
}

/* è¡¨å•å…ƒç´  */
.form-item {
    margin-bottom: 16px;
    position: relative;
}

.form-item label {
    display: block;
    position: absolute;
    left: 10px;
    top: 8px;
    color: #5b7a9d;
    font-size: 16px;
}

.form-item input {
    width: 100%;
    height: 36px;
    padding: 0 10px 0 32px;
    border: 1px solid #dce6f1;
    border-radius: 4px;
    background-color: #ffffff;
    color: #333;
    font-size: 14px;
    box-sizing: border-box;
}

.form-item input:focus {
    outline: none;
    border-color: #1a5fb4;
    box-shadow: 0 0 0 2px rgba(26, 95, 180, 0.1);
}

/* å›¾æ ‡ */
.icon-user:before { content: 'ğŸ‘¤'; }
.icon-lock:before { content: 'ğŸ”’'; }
.icon-role:before { content: 'ğŸ¢'; }
.icon-phone:before { content: 'ğŸ“±'; }
.icon-email:before { content: 'âœ‰ï¸'; }

/* ä¸‹æ‹‰æ¡†æ ·å¼ */
.select-wrapper {
    position: relative;
    width: 100%;
}

.select-wrapper:after {
    content: '';
    position: absolute;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #5b7a9d;
    pointer-events: none;
}

.form-item select {
    width: 100%;
    height: 36px;
    padding: 0 30px 0 32px;
    border: 1px solid #dce6f1;
    border-radius: 4px;
    background-color: #ffffff;
    color: #333;
    font-size: 14px;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    cursor: pointer;
}

.form-item select:focus {
    outline: none;
    border-color: #1a5fb4;
    box-shadow: 0 0 0 2px rgba(26, 95, 180, 0.1);
}

/* æŒ‰é’®æ ·å¼ */
.form-item button {
    width: 100%;
    height: 36px;
    border: none;
    border-radius: 4px;
    background-color: #1a5fb4;
    color: white;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
}

.form-item button:hover {
    background-color: #0c326f;
}

.form-item button.btn-secondary {
    background-color: #5b7a9d;
}

.form-item button.btn-secondary:hover {
    background-color: #46617d;
}

/* æŒ‰é’®ç»„ */
.btn-group {
    display: flex;
    gap: 10px;
}

.btn-group button {
    flex: 1;
}

/* åˆ†éš”çº¿ */
.form-divider {
    position: relative;
    text-align: center;
    margin: 15px 0;
}

.form-divider::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background-color: #edf2f7;
    z-index: 1;
}

.form-divider span {
    position: relative;
    z-index: 2;
    background-color: white;
    padding: 0 10px;
    font-size: 12px;
    color: #8897a8;
}

/* æ³¨å†Œé“¾æ¥ */
.form-item a {
    display: block;
    text-align: center;
    text-decoration: none;
    color: #1a5fb4;
    font-size: 14px;
}

.form-item a:hover {
    text-decoration: underline;
}

/* åº•éƒ¨ç‰ˆæƒä¿¡æ¯ */
.footer {
    position: absolute;
    bottom: 15px;
    left: 0;
    width: 100%;
    text-align: center;
}

.footer p {
    margin: 0;
    color: #8897a8;
    font-size: 12px;
}

.gov-info {
    margin-top: 5px;
}

.gov-info span {
    color: #8897a8;
    font-size: 11px;
    margin: 0 8px;
}

/* é®ç½©å±‚ */
.overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
}

/* æ¶ˆæ¯æ¡†æ ·å¼ */
.message-box {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 15px;
    border-radius: 4px;
    color: white;
    font-size: 14px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    z-index: 10000;
    transform: translateX(120%);
    transition: transform 0.3s ease-out;
    max-width: 90%;
}

.message-box.show {
    transform: translateX(0);
}

.message-icon {
    margin-right: 10px;
    font-size: 16px;
}

.message-text {
    flex: 1;
}

/* å“åº”å¼è°ƒæ•´ */
@media screen and (max-width: 480px) {
    .auth-form {
        width: 90%;
    }
    
    .system-title h1 {
        font-size: 20px;
    }
    
    .system-title p {
        font-size: 12px;
    }
    
    .btn-group {
        flex-direction: column;
    }
    
    .btn-group button {
        margin-bottom: 10px;
    }
}
</style>